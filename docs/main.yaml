openapi: 3.0.0
info:
  title: Red Anti Social API
  version: "1.0.0"
  description: Documentación de la API - Proyecto Red Anti Social (Grupo 3)
servers:
  - url: http://localhost:3000
    description: Servidor local
tags:
  - name: Comments
    description: Operaciones relacionadas con los comentarios
  - name: Posts
    description: Operaciones relacionadas con los posts
  - name: Tags
    description: Operaciones relacionadas con los tags
  - name: Users
    description: Operaciones relacionadas con los usuarios

paths:
  /comments:
    get:
      tags:
        - Comments
      summary: Obtener comentarios recientes
      description: Devuelve los comentarios creados dentro de los últimos N meses.
      parameters:
        - name: months
          in: query
          schema:
            type: integer
          description: Cantidad de meses hacia atrás (por defecto 6)
      responses:
        "200":
          description: Lista de comentarios recientes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentList'
        "500":
          description: Error al obtener los comentarios
    post:
      tags:
        - Comments
      summary: Crear un nuevo comentario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreate'
      responses:
        "201":
          description: Comentario creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        "500":
          description: Error al crear el comentario

  /comments/{id}:
    get:
      tags:
        - Comments
      summary: Obtener un comentario por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Comentario encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        "404":
          description: Comentario no encontrado
        "500":
          description: Error del servidor
    put:
      tags:
        - Comments
      summary: Actualizar un comentario existente
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreate'
      responses:
        "200":
          description: Comentario actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        "404":
          description: Comentario no encontrado
        "500":
          description: Error al actualizar el comentario
    delete:
      tags:
        - Comments
      summary: Eliminar un comentario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Comentario eliminado
        "404":
          description: Comentario no encontrado
        "500":
          description: Error al eliminar el comentario

  /posts:
    get:
      tags:
        - Posts
      summary: Obtener todos los posts
      responses:
        "200":
          description: Lista de posts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostList'
        "500":
          description: Error al obtener los posts
    post:
      tags:
        - Posts
      summary: Crear un nuevo post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostCreate'
      responses:
        "201":
          description: Post creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        "500":
          description: Error al crear el post

  /posts/{id}:
    get:
      tags:
        - Posts
      summary: Obtener un post por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Post encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        "404":
          description: Post no encontrado
        "500":
          description: Error del servidor
    put:
      tags:
        - Posts
      summary: Actualizar un post
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostCreate'
      responses:
        "200":
          description: Post actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        "404":
          description: Post no encontrado
        "500":
          description: Error al actualizar el post
    delete:
      tags:
        - Posts
      summary: Eliminar un post
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Post eliminado
        "404":
          description: Post no encontrado
        "500":
          description: Error al eliminar el post

  /posts/{id}/tags:
    get:
      tags:
        - Posts
      summary: Devuelve la/s etiqueta/s asociadas al post
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del post
      responses:
        '200':
          description: Post con la/s etiqueta/s asociada/s
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 5
                  title:
                    type: string
                    example: "Mi post de ejemplo"
                  content:
                    type: string
                    example: "Contenido del post"
                  tags:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        name:
                          type: string
                          example: "#Swagger"
        '404':
          description: Post no encontrado
        '500':
          description: Error interno del servidor

    post:
      tags:
        - Posts
      summary: Agrega una o varia/s etiqueta/s a un post
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tagIds:
                  type: array
                  items:
                    type: integer
                  example: [1, 2, 3]
      responses:
        '200':
          description: Etiqueta/s agregada/s correctamente
        '404':
          description: Post o tags no encontrados

    delete:
      tags:
        - Posts
      summary: Elimina una o varias etiquetas de un post
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tagIds:
                  type: array
                  items:
                    type: integer
                  example: [2]
      responses:
        '200':
          description: Tags eliminados correctamente
        '404':
          description: Post o tags no encontrados

  /posts/{id}/images:
    get:
      tags:
        - Posts
      summary: Obtener imágenes de un post
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del post
      responses:
        '200':
          description: Imágenes del post obtenidas correctamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  images:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        url:
                          type: string
                          example: "https://example.com/image1.jpg"
                        createdAt:
                          type: string
                          format: date-time
        '404':
          description: Post no encontrado
        '500':
          description: Error interno del servidor

    post:
      tags:
        - Posts
      summary: Agregar imágenes a un post
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                images:
                  type: array
                  items:
                    type: string
                  example: ["https://example.com/image1.jpg", "https://example.com/image2.jpg"]
      responses:
        '201':
          description: Imágenes agregadas correctamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Imágenes agregadas correctamente"
                  images:
                    type: array
                    items:
                      $ref: '#/components/schemas/PostImage'
        '400':
          description: Datos inválidos
        '404':
          description: Post no encontrado
        '500':
          description: Error interno del servidor

  /posts/{id}/images/{imageId}:
    delete:
      tags:
        - Posts
      summary: Eliminar una imagen específica de un post
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del post
        - name: imageId
          in: path
          required: true
          schema:
            type: integer
          description: ID de la imagen
      responses:
        '200':
          description: Imagen eliminada correctamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Imagen eliminada correctamente"
        '404':
          description: Post o imagen no encontrados
        '500':
          description: Error interno del servidor

  /tags:
    get:
      tags:
        - Tags
      summary: Obtener todas las etiquetas
      responses:
        "200":
          description: Lista de etiquetas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TagList'
        "500":
          description: Error al obtener las etiquetas
    post:
      tags:
        - Tags
      summary: Crear una nueva etiqueta
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TagCreate'
      responses:
        "201":
          description: Etiqueta creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        "500":
          description: Error al crear la etiqueta

  /tags/{id}:
    get:
      tags:
        - Tags
      summary: Obtener una etiqueta por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Etiqueta encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        "404":
          description: Etiqueta no encontrada
        "500":
          description: Error del servidor
    put:
      tags:
        - Tags
      summary: Actualizar una etiqueta
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TagCreate'
      responses:
        "200":
          description: Etiqueta actualizada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        "404":
          description: Etiqueta no encontrada
        "500":
          description: Error al actualizar la etiqueta
    delete:
      tags:
        - Tags
      summary: Eliminar una etiqueta
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Etiqueta eliminada
        "404":
          description: Etiqueta no encontrada
        "500":
          description: Error al eliminar la etiqueta

  /users:
    get:
      tags:
        - Users
      summary: Obtener todos los usuarios
      responses:
        "200":
          description: Lista de usuarios
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserList'
        "500":
          description: Error al obtener los usuarios
    post:
      tags:
        - Users
      summary: Crear un nuevo usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        "201":
          description: Usuario creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        "500":
          description: Error al crear el usuario

  /users/{id}:
    get:
      tags:
        - Users
      summary: Obtener un usuario por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Usuario encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        "404":
          description: Usuario no encontrado
        "500":
          description: Error del servidor
    put:
      tags:
        - Users
      summary: Actualizar un usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        "200":
          description: Usuario actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        "404":
          description: Usuario no encontrado
        "500":
          description: Error al actualizar el usuario
    delete:
      tags:
        - Users
      summary: Eliminar un usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Usuario eliminado
        "404":
          description: Usuario no encontrado
        "500":
          description: Error al eliminar el usuario

components:
  schemas:
    Comment:
      type: object
      properties:
        id:
          type: integer
        postId:
          type: integer
        userId:
          type: integer
        commentContent:
          type: string
        date:
          type: string
          format: date-time

    CommentCreate:
      type: object
      required:
        - postId
        - userId
        - commentContent
      properties:
        postId:
          type: integer
        userId:
          type: integer
        commentContent:
          type: string

    CommentList:
      type: array
      items:
        $ref: '#/components/schemas/Comment'

    Post:
      type: object
      properties:
        id:
          type: integer
        description:
          type: string
        userId:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PostCreate:
      type: object
      required:
        - description
        - userId
      properties:
        description:
          type: string
        userId:
          type: integer
        tags:
          type: array
          items:
            type: integer
          description: Array opcional de IDs de tags
          example: [1, 2, 3]
        images:
          type: array
          items:
            type: string
            format: uri
          description: Array opcional de URLs de imágenes
          example: ["https://example.com/imagen1.jpg", "https://example.com/imagen2.jpg"]

    PostList:
      type: array
      items:
        $ref: '#/components/schemas/Post'

    PostImage:
      type: object
      properties:
        id:
          type: integer
        postId:
          type: integer
        url:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Tag:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TagCreate:
      type: object
      required:
        - name
      properties:
        name:
          type: string

    TagList:
      type: array
      items:
        $ref: '#/components/schemas/Tag'

    User:
      type: object
      properties:
        id:
          type: integer
        nickName:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserCreate:
      type: object
      required:
        - nickName
      properties:
        nickName:
          type: string

    UserList:
      type: array
      items:
        $ref: '#/components/schemas/User'
